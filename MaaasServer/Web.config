<?xml version="1.0" encoding="utf-8"?>
<!--
    *** 
    Web.cloud.config
    ***
    This file represents the configuration for Node when deployed to the Cloud Service.  It's contents are
    manually copied over Web.config when deploying to the cloud (until NTVS beta automates this via Web.config
    Transform support).
    ***
-->
<configuration>
    <appSettings>
        <!--
        <add key="StorageAccountName" value="" />
        <add key="StorageAccountKey" value="" />
        <add key="ServiceBusNamespace" value="" />
        <add key="ServiceBusIssuerName" value="" />
        <add key="ServiceBusIssuerSecretKey" value="" />
        -->
    </appSettings>
    <system.webServer>
        <modules runAllManagedModulesForAllRequests="false" />

        <!-- NOTE: By default, debugging and logging are unsecure and should not be enabled for production applications in the cloud.-->
        <iisnode
            debuggingEnabled="true"
            loggingEnabled="true"
            devErrorsEnabled="true"
            watchedFiles="Web.config;*.js;routes\*.js;api\*.js;api\routes\*.js"
            nodeProcessCommandLine="&quot;D:\Program Files (x86)\nodejs\node.exe&quot;"
            />

        <webSocket enabled="false" />

        <!-- indicates that the server.js file is a node.js application to be handled by the iisnode module -->
        <handlers>
            <add name="iisnode" path="app.js" verb="*" modules="iisnode" />
        </handlers>
        <rewrite>
            <rules>
                <clear />
                <rule name="app" enabled="true" patternSyntax="ECMAScript" stopProcessing="true">
                    <match url="iisnode.+" negate="true" />
                    <conditions logicalGrouping="MatchAll" trackAllCaptures="false" />
                    <action type="Rewrite" url="app.js" />
                </rule>
            </rules>
        </rewrite>
    </system.webServer>
</configuration>