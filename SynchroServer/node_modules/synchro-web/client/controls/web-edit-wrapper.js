var logger = require('log4js').getLogger("web-edit-wrapper");

var WebControlWrapper = require('./web-control-wrapper');

var binding = require('../core/binding');
var CommandInstance = require('../core/command-instance');
var JToken = require('../core/json');

var WebEditWrapper = function(parent, bindingContext, controlSpec)
{
    this.base = WebControlWrapper;
    this.base(parent, bindingContext, controlSpec);
    logger.info("Edit control created");

    var edit = document.createElement("input");

    this._control = edit;

    var bindingSpec = binding.getCanonicalBindingSpec(controlSpec, "value");
    if (!this.processElementBoundValue("value", bindingSpec["value"], function() { return new JToken(edit.value) }, function(text) { edit.value = text.getValue() }))
    {
        this.processElementProperty(controlSpec, "value", function(text) { edit.value = text.getValue() });
    }

    edit.addEventListener("input", this.TextChanged.bind(this), false);
}
WebEditWrapper.prototype = Object.create(WebControlWrapper.prototype);

WebEditWrapper.prototype.TextChanged = function()
{
    logger.info("Edit text changed");
    this.updateValueBindingForAttribute("value");
}

module.exports = WebEditWrapper;