require('./test');

var assert = require("assert");
require("./assert-helper");

var util = require("../lib/util");

describe("Util", function () 
{
	describe("assignNewContents", function()
	{
		it("should populate object with new contents, removing any previous contents", function()
		{
			var src = { foo: "bar" };
			util.assignNewContents(src, { count: 69 });

			assert.objectsEqual(src, { count: 69 });
		});

		it("should not replace object with new object", function()
		{
			var src = { foo: "bar" };
			var src2 = src;
			util.assignNewContents(src, { count: 69 });

			assert.objectsEqual(src, { count: 69 });
			assert.equal(src2, src);
		});
	});

	describe("getObjectProperty", function () 
	{
		it("should be undefined when property not found", function()
		{
			var result = util.getObjectProperty({foo: "bar"}, "baz");
			assert.equal(result, undefined);
		});

		it("should return simple top level property", function()
		{
			var result = util.getObjectProperty({foo: "bar"}, "foo");
			assert.equal(result, "bar");
		});

		it("should return null when property value is null", function()
		{
			var result = util.getObjectProperty({foo: null}, "foo");
			assert.equal(result, null);
		});

		it("should return second level property when referenced using dot notation", function()
		{
			var obj = 
			{
				ages: 
				{
					bob: 48,
					blake: 46 
				}
			};
			var result = util.getObjectProperty(obj, "ages.blake");
			assert.equal(result, 46);
		});

		it("should return array element when referenced using numeric property name inside square bracket notation", function()
		{
			var obj = 
			{
				employees: ["Bob", "Blake"] 
			};
			assert.equal(util.getObjectProperty(obj, "employees[0]"), "Bob");
			assert.equal(util.getObjectProperty(obj, "employees[1]"), "Blake");
		});

		it("should return array element when referenced using numeric property name with dot notation", function()
		{
			var obj = 
			{
				employees: ["Bob", "Blake"] 
			};
			assert.equal(util.getObjectProperty(obj, "employees.0"), "Bob");
			assert.equal(util.getObjectProperty(obj, "employees.1"), "Blake");
		});

		it("should return object when value is object", function()
		{
			var obj = 
			{
				ages: 
				{
					bob: 48,
					blake: 46 
				}
			};
			assert.objectsEqual(util.getObjectProperty(obj, "ages"), { bob: 48, blake: 46 } );
		});
	});

	describe("setObjectProperty", function () 
	{
		it("should set new top level property", function()
		{
			var obj = {};
			var result = util.setObjectProperty(obj, "foo", "bar");
			assert.objectsEqual(obj, { foo: "bar" });
		});

		it("should updated exising top level property", function()
		{
			var obj = {foo: "baz"};
			var result = util.setObjectProperty(obj, "foo", "bar");
			assert.objectsEqual(obj, { foo: "bar" });
		});

		it("should fail to create intermediate object", function()
		{
			var obj = {};
			var result = util.setObjectProperty(obj, "foo.bar", "baz");
			assert.objectsEqual(obj, {});
		});

		it("should set second level property when first level exists", function()
		{
			var obj = { ages: {} };
			var result = util.setObjectProperty(obj, "ages.bob", 48);
			assert.objectsEqual(obj, { ages: { bob: 48 } });
		});

		it("should set array element referenced using numeric property name", function()
		{
			var obj = { employees: ["Bob"] };
			var result = util.setObjectProperty(obj, "employees.1", "Blake");
			assert.objectsEqual(obj, { employees: ["Bob", "Blake"] });
		});

		it("should set property to object when object passed", function()
		{
			var obj = { foo: "baz" };
			var result = util.setObjectProperty(obj, "foo", { bar: "baz" });
			assert.objectsEqual(obj, { foo: { bar: "baz" } });
		});

		it("should null property on object when null value passed", function()
		{
			// !!! Should this actually clear the property?
			var obj = { foo: "bar", baz: "fraz" };
			var result = util.setObjectProperty(obj, "foo", null);
			assert.objectsEqual(obj, { foo: null, baz: "fraz" });
		});
	});

});