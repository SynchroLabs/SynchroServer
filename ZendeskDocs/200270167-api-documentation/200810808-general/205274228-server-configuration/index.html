
<html>
  <head>
    <meta charset='UTF-8'>
    <link rel='stylesheet' href='http://output.jsbin.com/gefofo.css' />
  </head>
  <body>
    <div id='container'>
    
      <h1>Server Configuration</h1>
      <p>This article covers the configuration mechanism used by Synchro Server.  For more information about the actual configuration settings, please see: <a href="/hc/en-us/articles/215381747">Server Configuration Settings</a>.</p>
<p>Configuration works the same (and is shared) between Synchro server (app.js) and Synchro CLI commands.</p>
<p>Each configuration value is determined by evaluating the following, in order, until a value is found:</p>
<ol>
<li>Command line parameters</li>
<li>Environment variables</li>
<li>The Configuration File</li>
<li>Built-in, Default Values</li>
</ol>
<h2>Specifying the Configuration File</h2>
<p>By default, both the Synchro server and all Synchro CLI commands will use a configuration file named "config.json" in the main application directory of the Synchro server (which is also the directory where Synchro CLI commands for that server will be executed).</p>
<p>You may specify a different configuration file as a command line parameter, or set a reference to the configuration file to be used in an environment variable. In addition to any general configuration settings, the configuration file may contain service definition/configuration, and the list of installed apps for that configuration. This makes it easy to define multiple configurations which might use different services and serve different sets of applications (such as “local”, “azure”, “azure-dev”, etc).</p>
<p>Example: Synchro server with config on command line:</p>
<pre>node app.js -c config.json
</pre>
<p>Example: Synchro CLI with config on command line:</p>
<pre>synchro new hello-world -c azure.json
</pre>
<p>Example: Setting the config via an environment variable:</p>
<pre>set SYNCHRO_CONFIG=azure-dev.json
</pre>
<p>If set via an environment variable (and not overridden on the command line), both the Synchro server and Synchro CLI will use that configuration.</p>
<h2>Environment Variables</h2>
<p>To define a configuration setting via an environment variable, prefix the setting with<code>SYNCHRO__</code> and use the <code>__</code> (double underscore) separator as needed to represent any configuration member paths.</p>
<p>For example, to set the value MODULESTORE.storageAccount (for the Azure module store), you would do:</p>
<pre>set SYNCHRO__MODULESTORE__storageAccount=xxxxxxxxxx
</pre>
<p>A common approach is to use a config file for many settings, but to supplement those settings using environment variables for things that are either deployment-specific or secure/secret. For example, if you had a configuration element that contained an API key, and you didn't want that value contained in the files you push to your cloud server, or checked in to your revision control system, your could just specify that particular value using an environment variable.</p>
<h2>Configuration Setting Example</h2>
<p>A commonly used and easy to understand configuration setting is <code>PORT</code>, which defines the port on which the server will listen.</p>
<h4>Default Value</h4>
<p>The default value for <code>PORT</code> is 1337. This value will be used unless it is overridden by one of the methods below.</p>
<h4>Configuration File</h4>
<p>The <code>PORT</code> can be defined in your configuration file, for example:</p>
<pre>{
    PORT: 8000
}
</pre>
<p>This will override the default value.</p>
<h4>Environment Variable</h4>
<p>You can set the value for <code>PORT</code> via an environment variable (as described above), which will override any default or config-file-specified <code>PORT</code>. For example:</p>
<pre>set SYNCHRO__PORT=8080</pre>
<h4>Command Line</h4>
<p>The <code>PORT</code> can be set via the command line using the "-p" or "--port" flags. If set via the command line, that setting will override any other method of setting the port. For example:</p>
<pre>$ node app.js -p 8888</pre>
<h2>Application Configuration</h2>
<p>The set of Synchro apps being served is represented by the top level configration element <code>APPS</code>, which is itself a dictionary of path mappings, each of which contains a dictionary of data related to the app being served at that path.</p>
<p>For example:</p>
<pre>{
    "APPS": {
        "samples": {
            "container": "samples"
        }
        "samples2": {
            "container": "samples"
        }
        "civics": {
            "container": "civics",
            "GOOGLE_API_KEY": "meowquackwoof"
        }
    }
}
</pre>
<p>The set of keys under <code>APPS</code> define the endpoint suffix at which an app will be served and contain the configuration for the app to be served at that endpoint.</p>
<p>The only required element in the configuration of an app is <code>container</code>, which indicates the module store container in which the app is defined (in the default file module store, this will just be the name of the directory under "synchro-apps" in which the app resides).</p>
<p>In the example above, we see that the server is serving three apps. The first one is from the container "samples" and is being served at the endpoint <code>/api/samples</code>. The second one is also from the container "samples", but is being served from the endpoint <code>/api/samples2</code>. The third one is from the container "civics" and is being server at <code>/api/civics</code>.</p>
<p>The "civics" app definition also contains some app-specific configuration (the GOOGLE_API_KEY). The civics app can access that configuration setting within the app by doing</p>
<pre><code>var myKey = Synchro.getConfig("GOOGLE_API_KEY");
</code></pre>
<p>You might be wondering why it would be useful to serve more than one instance of an app. The main reason is that you might want to serve multiple instances of the same app, but with different configuration. For example:</p>
<pre>{
    "APPS": {
        "inventory": {
            "container": "inventoryApp",
            "DB_PATH": "productionDb"
        }
        "inventorytest": {
            "container": "inventoryApp"
            "DB_PATH": "testDb"
        }
    }
}
</pre>
      
    </div>
  </body>
</html>
    
