
<html>
  <head>
    <meta charset='UTF-8'>
    <link rel='stylesheet' href='http://output.jsbin.com/gefofo.css' />
  </head>
  <body>
    <div id='container'>
    
      <h1>List 2: List view loaded asynchronously</h1>
      <p>In real-world apps, it is often the case that ViewModel data needs to be populated asynchronously (such as when loading data from a database, or by calling a network API).  Synchro accommodates asynchronous processing in app code using a variety of mechanisms to allow an immediate response, with optional interim responses, and then a final response, over time.  For details on the various types of asynchronous support provided in Synchro (and used in this example), see: <a href="/hc/en-us/articles/206058467-Asynchronous-Processing">Asynchronous Processing</a>.</p>
<p><em>Note:</em> The budget for composing a response to any Synchro app function is 25ms.  If the process cannot be completed in that amount of time, then asynchronous techniques should be employed. </p>
<p>The asynchronous technique demonstrated below is called "delayed ViewModel initialization".  With this technique, the response to <code>InitializeViewModel</code> is returned immediately, and then since <code>LoadViewModel</code> is present, that function will automatically be called so that the asynchronous loading of the ViewModel may continue/complete.</p>
<p>It is common to employ a value in the ViewModel to indicate to the View that it is in a "loading" state.  Below, we use the <code>isLoading</code> member of the ViewModel for that purpose, and we use two sets of controls whose visibility is bound to that value to show the "loading" and "loaded" states. </p>
<p>The call to <code>Synchro.yieldAwaitable</code> is just a mechanism to generate a delay before we load the ViewModel.  In a real application, <code>Synchro.yieldAwaitable</code> would yield to your asynchronous thunk, generator, Promise, etc.</p>
<p><strong>Module: list2.js - <a href="https://github.com/SynchroLabs/SynchroTutorial/blob/master/list2.js">View on GitHub</a></strong></p>
<pre><code>var imgUser = Synchro.getResourceUrl("user.png");

exports.InitializeViewModel = function(context, session, params, state)
{
    return {
        <span class="mark">isLoading: true</span>
    }
}

<span class="mark">exports.LoadViewModel = function * (context, session, viewModel)
{
    yield Synchro.yieldAwaitable(context, function(callback){ setTimeout(callback, 4000) });
    viewModel.people = [
         { first: "Betsy", last: "Braddock" }, 
         { first: "Steven", last: "Rogers" }, 
         { first: "Natasha", last: "Romanoff" }, 
         { first: "Tony", last: "Stark" }, 
         { first: "Wade", last: "Wilson" }, 
    ];
    viewModel.isLoading = false;
}</span>

exports.View =
{
    title: "List 2",
    elements:
    [
<span class="mark">        { control: "stackpanel", orientation: "Vertical", visibility: "{isLoading}", contents: [
            { control: "progressring", value: "{isLoading}", verticalAlignment: "Center" },
            { control: "text", value: "Loading...", color: "Red", font: { size: 24, bold: true }, verticalAlignment: "Center" },
        ] },</span>
        { control: "stackpanel", orientation: "Vertical", width: "*", <span class="mark">visibility: "{!isLoading}",</span> contents: [
            { control: "listview", select: "None", width: "*", binding: "people", itemTemplate:
                { control: "stackpanel", orientation: "Horizontal", width: "*", padding: 5, contents: [
                    { control: "image", resource: imgUser, height: 50, width: 50, verticalAlignment: "Center" },
                    { control: "stackpanel", orientation: "Vertical", contents: [
                        { control: "text", value: "{first}" },
                        { control: "text", value: "{last}" },
                    ] },
                ] },
            },
        ] },
    ]
}</code></pre>
<p>In the interval between when <code>IntializeViewModel</code> returns and <code>LoadViewModel</code> returns (approximately 4 seconds), this module will show a "Loading" view, as below: </p>
<p><img src="https://support.synchro.io/hc/en-us/article_attachments/207362808/List2.png" alt="" /></p>
<p>After <code>LoadViewModel</code> returns the ViewModel with the populated list (and <code>isLoading</code> set to false), this module will display the loaded list as below:</p>
<p><img src="https://support.synchro.io/hc/en-us/article_attachments/207407447/List2a.png" alt="" /></p>
<p><strong>Next - <a href="/hc/en-us/articles/219090528">List 3: List view with nav to detail view</a> </strong></p>
<p> </p>
<p> </p>
      
    </div>
  </body>
</html>
    
