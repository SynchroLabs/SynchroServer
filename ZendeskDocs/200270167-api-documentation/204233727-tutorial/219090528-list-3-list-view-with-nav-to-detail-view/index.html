
<html>
  <head>
    <meta charset='UTF-8'>
    <link rel='stylesheet' href='http://output.jsbin.com/gefofo.css' />
  </head>
  <body>
    <div id='container'>
    
      <h1>List 3: List view with nav to detail view</h1>
      <p>In the example below we demonstrate the mechanisms for navigating between Views, as well as for maintaining View state and passing data between Views.  For more details on these mechanisms and techniques, see <a href="/hc/en-us/articles/206058697-Navigation-Support">Navigation Support</a>.</p>
<p>Navigation from a view to a child view is accomplished via <code>Synchro.pushAndNavigateTo()</code>.  Navigation from the child view back to the parent view is accomplished via <code>Synchro.pop()</code>.</p>
<p>When navigating to a child view via <code>Synchro.pushAndNavigateTo()</code>, the parent view can specify a params object to be passed to the child view's <code>InitializeViewModel</code> function, as well as its own "state", which will be preserved and passed back to it when its own <code>InitializeViewModel</code> function is called upon return.  In the example below, the parent specifies its entire ViewModel as "state", but in practice this can be any data (including a subset or superset of the ViewModel) that is required.  Storing and restoring state allows applications to avoid lengthy repopulation of parent ViewModels, as in our example here (note that we don't have the simulated 4 second wait when we come back to the list view from the detail view).</p>
<p>In the <code>IntializeViewModel</code> of the list view below, a check is done to determine whether the view state is being restored or needs to be regenerated (reloaded).  In addition, any changes made by a child view (and stored in the session) are processed.</p>
<p><strong>Module: list3.js - <a href="https://github.com/SynchroLabs/SynchroTutorial/blob/master/list3.js">View on GitHub</a></strong></p>
<pre><code>var imgUser = Synchro.getResourceUrl("user.png");

exports.InitializeViewModel = function(context, session, params, state)
{
<span class="mark">    var viewModel = state;
    if (viewModel == null)
    {
        viewModel = { isLoading: true };
    }
    else if (session.updatedPerson)
    {
        viewModel.people[session.updatedPerson.index] = session.updatedPerson.person;
        delete session.updatedPerson;
    }

    return viewModel;</span>
}

exports.LoadViewModel = function * (context, session, viewModel)
{
    <span class="mark">if (viewModel.people === undefined)</span>
    <span class="mark">{</span>
        yield Synchro.yieldAwaitable(context, function(callback){ setTimeout(callback, 4000) });
        viewModel.people = [
             { first: "Betsy", last: "Braddock" }, 
             { first: "Steven", last: "Rogers" }, 
             { first: "Natasha", last: "Romanoff" }, 
             { first: "Tony", last: "Stark" }, 
             { first: "Wade", last: "Wilson" }, 
        ];
        viewModel.isLoading = false;
    <span class="mark">}</span>
}

exports.View =
{
    title: "List 3",
    elements:
    [
        { control: "stackpanel", orientation: "Vertical", visibility: "{isLoading}", contents: [
            { control: "progressring", value: "{isLoading}", verticalAlignment: "Center" },
            { control: "text", value: "Loading...", color: "Red", font: { size: 24, bold: true }, verticalAlignment: "Center" },
        ] },
        { control: "stackpanel", orientation: "Vertical", width: "*", contents: [
            { control: "listview", select: "None", width: "*", 
              binding: { items: "people", <span class="mark">onItemClick: { command: "onSelected", person: "{$data}", index: "{$index}" }</span> }, 
              itemTemplate:
                { control: "stackpanel", orientation: "Horizontal", width: "*", padding: 5, contents: [
                    { control: "image", resource: imgUser, height: 50, width: 50, verticalAlignment: "Center" },
                    { control: "stackpanel", orientation: "Vertical", contents: [
                        { control: "text", value: "{first}" },
                        { control: "text", value: "{last}" },
                    ] },
                ] },
            },
        ] },
    ]
}

exports.Commands = 
{
<span class="mark">    onSelected: function (context, session, viewModel, params)
    {
        return Synchro.pushAndNavigateTo(context, "hello8", params, viewModel);
    },</span>
}</code></pre>
<p>The view will be generated as in the previous example with a 4 second delay and "loading" status, unless we are returning from a child view, in which case the list view will be restored instantly.</p>
<p>When an item in the list is clicked, the <code>onSelected</code> command will be called, and the child view will be activated. </p>
<p><img src="https://support.synchro.io/hc/en-us/article_attachments/207362828/List3.png" alt="" /></p>
<p>The detail view below receives its initial data from the parent view by way of <code>params</code>, which it uses to populate its ViewModel.  When "Submit" is pressed, any edits are stored in the session object (for the parent to process upon return), then <code>Synchro.pop()</code> returns control to the parent.</p>
<p><strong>Module: hello8.js - <a href="https://github.com/SynchroLabs/SynchroTutorial/blob/master/hello8.js">View on GitHub</a></strong></p>
<pre><code>exports.InitializeViewModel = function(context, session, params, state) {
    return {
        firstName: <span class="mark">params.person.first,</span>
        lastName: <span class="mark">params.person.last,</span>
        <span class="mark">index: params.index,</span>
        textStyle: { fontsize: 12, verticalAlignment: "Center" },
        labelStyle: { width: 200, textAlignment: "Right" },
        editStyle: { width: 240 }
    }
}

exports.View =
{
    title: "Hello World 8",
    elements:
    [
        { control: "text", value: "Enter name:", font: { size: "{textStyle.fontsize}", bold: true } },
        { control: "stackpanel", orientation: "Horizontal", contents: [
            { control: "text", value: "First name:", style: "textStyle, labelStyle" },
            { control: "edit", binding: "firstName", style: "textStyle, editStyle" },
        ] },
        { control: "stackpanel", orientation: "Horizontal", contents: [
            { control: "text", value: "Last name:", style: "textStyle, labelStyle" },
            { control: "edit", binding: "lastName", style: "textStyle, editStyle" },
        ] },
        { control: "button", caption: "Submit", binding: "onSubmit", enabled: "eval({firstName} &amp;&amp; {lastName})" },
    ]
}

exports.Commands =
{
    onSubmit: function(context, session, viewModel)
    {
<span class="mark">        session.updatedPerson = { index: viewModel.index, person: { first: viewModel.firstName, last: viewModel.lastName }};
        Synchro.pop(context);</span>
    }
}</code></pre>
<p>The name can be edited in the child view below, and the changes will be displayed on the parent list view page. </p>
<p><img src="https://support.synchro.io/hc/en-us/article_attachments/207362848/Hello8.png" alt="" /></p>
<p><strong>Next - <a href="/hc/en-us/articles/219090588">Conclusion</a> </strong></p>
<p> </p>
<p> </p>
      
    </div>
  </body>
</html>
    
